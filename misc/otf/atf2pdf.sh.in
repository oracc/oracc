#!/bin/sh
#
# N.B. THIS SCRIPT IS TO MAKE A PDF FROM A SINGLE ATF FILE
#
project=$1
pqx=$2
workdir=$3

if [ "$project" == "" ] || [ "$pqx" == "" ] || [ "$workdir" == "" ]; then
    echo atf2pdf.sh: please give PROJECT PQX-ID PDFDIR on commandline
    exit 1
fi

if [ ! -d $workdir ]; then
    echo atf2pdf.sh: working directory $workdir needs creating
    exit 1
fi

atffile=`@@ORACC_BUILDS@@/bin/pqxpand atf $project:$pqx`

if [ ! -r $atffile ]; then
    echo atf2pdf.sh: ATF file $atffile non-existent or unreadable
    exit 1
fi

PATH=$PATH:@@ORACC_BUILDS@@/bin ; export PATH

pdffile="$pqx.pdf"

>&2 echo $0: Making $project $pqx.pdf in $workdir

(cd $workdir ; rm -fr odt ; mkdir -p odt ; \
 atf-driver.sh $project $pqx $atffile $workdir ; chmod 0644 *otf* )

exit 0
